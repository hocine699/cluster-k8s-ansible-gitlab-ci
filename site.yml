---
- name: "Déploiement d'un cluster Kubernetes sur Ubuntu 24.04"
  hosts: all
  become: true
  gather_facts: true
  
  pre_tasks:
    - name: "Mise à jour du cache APT"
      apt:
        update_cache: yes
        cache_valid_time: 3600

  roles:
    - common
    - containerd
    - kubernetes
    - role: master
      when: inventory_hostname in groups['masters']
    - role: worker
      when: inventory_hostname in groups['workers']

- name: "Vérification finale du cluster"
  hosts: all
  become: true
  roles:
    - verification
  run_once: true