---
- name: "Préparation de tous les nœuds"
  hosts: all
  become: true
  gather_facts: true
  
  pre_tasks:
    - name: "Mise à jour du cache APT"
      apt:
        update_cache: yes
        cache_valid_time: 3600

  roles:
    - common
    - containerd
    - kubernetes

- name: "Initialisation du nœud master"
  hosts: masters
  become: true
  roles:
    - master

- name: "Déploiement des workers"
  hosts: workers
  become: true
  roles:
    - worker

- import_playbook: post-install.yml

- name: "Vérification finale du cluster"
  hosts: all
  become: true
  roles:
    - verification
  run_once: true